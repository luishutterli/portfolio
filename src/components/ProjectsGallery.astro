---
import { getCollection, type CollectionEntry } from "astro:content";
import ProjectCard from "./ProjectCard.astro";

const projects = await getCollection("projects");

// Sort projects: featured first, then by state (Fertig first), then by start date
const sortedProjects = projects.sort(
  (a: CollectionEntry<"projects">, b: CollectionEntry<"projects">) => {
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;

    if (a.data.state === "Fertig" && b.data.state === "In Arbeit") return -1;
    if (a.data.state === "In Arbeit" && b.data.state === "Fertig") return 1;

    const aDate = a.data.startDate || new Date(0);
    const bDate = b.data.startDate || new Date(0);
    return bDate.getTime() - aDate.getTime();
  },
);

const featuredProjects = sortedProjects.slice(0, 6);
---

<section class="bg-background-light px-4 lg:px-6 py-6">
  <div class="mx-auto max-w-6xl">

    <div class="mb-4 text-center">
      <h2 
        class="mb-2 font-bold text-slate-900 text-2xl lg:text-3xl"
        transition:name="projects-heading"
      >
        Meine Projekte
      </h2>
      <p class="mx-auto max-w-2xl text-neutral text-base leading-relaxed">
        Eine Auswahl meiner neuesten Arbeiten und Projekte. Von Full-Stack Entwicklung bis hin zu innovativen LÃ¶sungen.
      </p>
    </div>


    <div class="gap-4 lg:gap-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 mb-4">
      {featuredProjects.map((project: CollectionEntry<"projects">) => (
        <div class="group hover:scale-105 transition-transform duration-300">
          <ProjectCard project={project} />
        </div>
      ))}
    </div>


    <div class="text-center">
      <a 
        href="/projects" 
        class="inline-flex items-center gap-2 bg-gradient-to-r from-neutral-dark hover:from-neutral-darker to-primary hover:to-primary-hover hover:shadow-primary/20 hover:shadow-xl px-8 py-4 rounded-xl font-semibold text-white hover:scale-105 transition-all duration-300 transform"
        transition:name="view-all-projects"
      >
        Alle Projekte ansehen
        <svg 
          class="w-5 h-5 transition-transform group-hover:translate-x-1 duration-300" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
        >
          <path 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="2" 
            d="M13 7l5 5m0 0l-5 5m5-5H6"
          />
        </svg>
      </a>
    </div>
  </div>
</section>
